var init_main=function(t,i){var n=angular.module(t,[]);$(".site-controller").each(function(){var t=$(this),e=t.data("siteControllerName"),r=t.data("siteControllerType");if("data"==r.toLowerCase()){var a=t.data("siteControllerUrl"),o=t.data("siteControllerRegionFilter").split(";"),d=t.data("siteControllerRegionName");init_controller_data(n,t,e,i,o,d,a)}}),angular.bootstrap(document,[t])},init_controller_data=function(t,i,n,e,r,a,o){t.controller(n,function(t,i){t.datasets=[],$.ajax({dataType:"xml",url:o,success:function(i){t.datasets=parseCSW(i,e,r,a),t.$apply()}})})},buildBoundingBox=function(t){var i=[0,0,0,0];try{i=[parseFloat(parseFloat(t.find("westBoundLongitude").text().trim()).toFixed(4)),parseFloat(parseFloat(t.find("southBoundLatitude").text().trim()).toFixed(4)),parseFloat(parseFloat(t.find("eastBoundLongitude").text().trim()).toFixed(4)),parseFloat(parseFloat(t.find("northBoundLatitude").text().trim()).toFixed(4))]}catch(n){i=[0,0,0,0]}return i},ellipsis=function(t,i){return-1==i?t:t.length>i?t.substring(0,i-3)+"...":t},sortLayers=function(t){return t.sort(function(t,i){return t.options.zIndex-i.options.zIndex})},updateRenderOrder=function(t){for(var i=0;i<t.length;i++)t[i].bringToFront()},formatDate=function(t){return void 0!==t?t.getFullYear()+"-"+(t.getMonth()<9?"0"+(t.getMonth()+1):t.getMonth()+1)+"-"+(t.getDate()<10?"0"+t.getDate():t.getDate()):""},parseCSW=function(t,i,n,e){var r=[];return $(t).find("SearchResults").find("MD_Metadata").each(function(){var t=$(this),a=t.find("identificationInfo").find("MD_DataIdentification"),o=t.find("distributionInfo").find("MD_Distribution"),d=a.find("EX_GeographicBoundingBox:first"),l=o.find("onLine").filter(function(){return"WWW:LINK-1.0-http--link"==$(this).find("protocol").find("CharacterString").text()}).find("URL").text().trim();if(l.startsWith(i)&&d.length>0){var f=a.find("title").find("CharacterString").text(),s=a.find("date").find("DateTime").text(),u=a.find("graphicOverview").find("fileName").text().trim(),c=ellipsis(a.find("abstract").find("CharacterString").text().replace("\n",""),200),p=a.find("descriptiveKeywords").filter(function(){return"place"==$(this).find("type").text().trim()}).find("keyword").map(function(){return $(this).text().trim()}).get(),h=o.find("onLine").filter(function(){return"WWW:DOWNLOAD-1.0-http--download"==$(this).find("protocol").text().trim()}).filter(function(){return $(this).find("name").text().trim().endsWith(".zip")}).find("URL").text().trim(),g=o.find("onLine").filter(function(){return"WWW:DOWNLOAD-1.0-http--download"==$(this).find("protocol").text().trim()}).filter(function(){return $(this).find("name").text().trim().endsWith(".json")}).find("URL").text().trim(),x={title:f,date_published:formatDate(new Date(Date.parse(s))),region:e,"abstract":c,url_detail:l,url_shapefile:h,url_geojson:g,url_region:"",url_thumbnail_200x150:u};$(p).filter(n).length>0&&r.push(x)}}),r};