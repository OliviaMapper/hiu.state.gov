var init_main=function(t,e){var i=angular.module(t,[]);$(".site-controller").each(function(){var t=$(this),n=t.data("siteControllerName"),r=t.data("siteControllerType");if("data"==r.toLowerCase()){var a=t.data("siteControllerUrl"),o=["Syrian Arab Republic","Turkey"],d=t.data("siteControllerRegionName");init_controller_data(i,t,n,e,o,d,a)}}),angular.bootstrap(document,[t])},init_controller_data=function(t,e,i,n,r,a,o){t.controller(i,function(t,e){t.datasets=[],$.ajax({dataType:"xml",url:o,success:function(e){t.datasets=parseCSW(e,n,r,a),t.$apply()}})})},buildBoundingBox=function(t){var e=[0,0,0,0];try{e=[parseFloat(parseFloat(t.find("westBoundLongitude").text().trim()).toFixed(4)),parseFloat(parseFloat(t.find("southBoundLatitude").text().trim()).toFixed(4)),parseFloat(parseFloat(t.find("eastBoundLongitude").text().trim()).toFixed(4)),parseFloat(parseFloat(t.find("northBoundLatitude").text().trim()).toFixed(4))]}catch(i){e=[0,0,0,0]}return e},ellipsis=function(t,e){return-1==e?t:t.length>e?t.substring(0,e-3)+"...":t},sortLayers=function(t){return t.sort(function(t,e){return t.options.zIndex-e.options.zIndex})},updateRenderOrder=function(t){for(var e=0;e<t.length;e++)t[e].bringToFront()},formatDate=function(t){return void 0!==t?t.getFullYear()+"-"+(t.getMonth()<9?"0"+(t.getMonth()+1):t.getMonth()+1)+"-"+(t.getDate()<10?"0"+t.getDate():t.getDate()):""},parseCSW=function(t,e,i,n){var r=[];return $(t).find("SearchResults").find("MD_Metadata").each(function(){var t=$(this),a=t.find("identificationInfo").find("MD_DataIdentification"),o=t.find("distributionInfo").find("MD_Distribution"),d=a.find("EX_GeographicBoundingBox:first"),l=o.find("onLine").filter(function(){return"WWW:LINK-1.0-http--link"==$(this).find("protocol").find("CharacterString").text()}).find("URL").text().trim();if(l.startsWith(e)&&d.length>0){var s=a.find("title").find("CharacterString").text(),u=a.find("date").find("DateTime").text(),f=a.find("graphicOverview").find("fileName").text().trim(),c=ellipsis(a.find("abstract").find("CharacterString").text().replace("\n",""),200),p=a.find("descriptiveKeywords").filter(function(){return"place"==$(this).find("type").text().trim()}).find("keyword").map(function(){return $(this).text().trim()}).get(),g={title:s,date_published:formatDate(new Date(Date.parse(u))),region:n,"abstract":c,url_detail:l,url_region:"",url_thumbnail_200x150:f};$(p).filter(i).length>0&&r.push(g)}}),r};