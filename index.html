---
layout: map
title: "HIU"

tilelayers:
  - id: "hiu.nbk3c19e,hiu.lp5bfbt9"
    type: "mapbox"
    attribution: "Names and boundary representation are not necessarily authoritative."
    description: "On the fly composite of MapBox satellite with LSIB boundaries"
    zIndex: 18

layerswitcher:
  
---

<link rel="stylesheet" href="{{ site.baseurl }}/lib/font-awesome-4.6.3/css/font-awesome.min.css" type="text/css" media="all" />

<link rel="stylesheet" href="{{ site.baseurl }}/lib/leaflet/1.0.0-b1/leaflet.css" type="text/css" media="all" />

<link rel="stylesheet" href="{{ site.baseurl }}/lib/leaflet-sidebar/leaflet-sidebar.css" type="text/css" media="all" />

<!--disables scroll bar-->
<style type="text/css">
body {
    overflow:hidden;
}
.region_label {
  color: #0A2E52;
  background: #fff;
  background: rgba(255,255,255,0.8);
  box-shadow: 0 0 15px rgba(0,0,0,0.2);
  border-radius: 5px;
  padding: 0px 3px 0px 3px;
  display: inline-block
}


body {
  background-color: black;
}

#earth {
  width: 80px;
  height: 80px;
  background: url(http://www.noirextreme.com/digital/Earth-Color4096.jpg);
  border-radius: 50%;
  background-size: 210px;
  box-shadow: inset 16px 0 40px 6px rgb(0, 0, 0),
    inset -3px 0 6px 2px rgba(255, 255, 255, 0.2);
}

@keyframes rotate {
  from { background-position-x: 0px; }
  to { background-position-x: 210px; }
}

#earth:hover{
    -webkit-border-radius: 10px;
    -moz-border-radius: 10px;
    border-radius: 50%;
    -webkit-box-shadow: 0px 0px 30px 0px rgba(0, 255, 0, 0.67);
    -moz-box-shadow:    0px 0px 30px 0px rgba(0, 255, 0, 0.67);
    box-shadow:         0px 0px 30px 0px rgba(0, 255, 0, 0.67);
}


.info {
  padding: 6px 8px;
  font: 14px/16px Arial, Helvetica, sans-serif;
  border-radius: 5px;
}
.info h4 {
  margin: 0 0 5px;
  color: #d73f3f;
}

.leaflet-top .leaflet-control {
    margin-top: 65px;
}

</style>


<!--<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="https://d3js.org/d3.v3.min.js"></script>
<script src="https://d3js.org/topojson.v1.min.js"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>-->

<script src="{{ site.baseurl }}/lib/d3/d3.v3.min.js"></script>
<script src="{{ site.baseurl }}/lib/d3/topojson.v1.min.js"></script>
<script src="{{ site.baseurl }}/lib/queue/queue.v1.min.js"></script>

<!--style="height: calc(100% - 61px); position:relative;"-->
    <div id="sidebar" class="sidebar" style="margin-top: 61px;">
          <!-- Nav tabs -->
          <div class="sidebar-tabs">
              <ul role="tablist">
                  <li class="active"><a href="#home" role="tab"><i class="fa fa-bars"></i></a></li>
<!--
                  <li><a href="#profile" role="tab"><i class="fa fa-user"></i></a></li>
                  <li class="disabled"><a href="#messages" role="tab"><i class="fa fa-envelope"></i></a></li>
-->

              </ul>
<!--
              <ul role="tablist">
                  <li><a href="#settings" role="tab"><i class="fa fa-gear"></i></a></li>
              </ul>
-->
          </div>

              <!-- Tab panes -->
          <div class="sidebar-content">
              <div class="sidebar-pane active" id="home">
                  <h1 class="sidebar-header">
                      Humanitarian Information Unit (HIU)
                      <span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
                  </h1>
                  <br>
                  <p>The HIU serves as a U.S. Government interagency center to identify, collect, analyze, and disseminate all-source information critical to U.S. Government decision-makers and partners in preparation for and response to humanitarian emergencies worldwide, and to promote innovative technologies and best practices for humanitarian information management.</p>

                  <p><b>Select different regions on the map to view our products</b></p>

                  <p>
                    <img src="{{ site.baseurl }}/assets/img/mapgive_red_pt.png" style="width: 30px;height: 45px;"><b>&nbsp&nbsp&nbsp sudden-onset disaster</b>
                    &nbsp&nbsp&nbsp<img src="{{ site.baseurl }}/assets/img/mapgive_blue_pt.png" style="width: 30px;height: 45px;"><b>&nbsp&nbsp&nbsp products</b>
                  </p>

              </div>

<!--
              <div class="sidebar-pane" id="profile">
                  <h1 class="sidebar-header">Profile<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
              </div>

              <div class="sidebar-pane" id="messages">
                  <h1 class="sidebar-header">Messages<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
              </div>

              <div class="sidebar-pane" id="settings">
                  <h1 class="sidebar-header">Settings<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
              </div>
-->
          </div>
      </div>




<div id="map" class="sidebar-map" style="top:0px;left:0px;width:100%;height:100%;margin-top: -55px;"></div>

<script src="{{ site.baseurl }}/lib/leaflet-sidebar/leaflet-sidebar.js"></script>

<div class="bureau-name"></div>

<script>
    L.TopoJSON = L.GeoJSON.extend({  
      addData: function(jsonData) {    
        if (jsonData.type === "Topology") {
          for (key in jsonData.objects) {
            geojson = topojson.feature(jsonData, jsonData.objects[key]);
            L.GeoJSON.prototype.addData.call(this, geojson);
          }
        }    
        else {
          L.GeoJSON.prototype.addData.call(this, jsonData);
        }
      }  
    });
</script>


<script>

    (function(){


            var layerswitcher = $('#menu-ui');

            //var map = L.map('map').setView([0, 30], 3);

            L.mapbox.accessToken = 'pk.eyJ1IjoiaGl1IiwiYSI6InJWNGZJSzgifQ.xK1ndT3W8XL9lwVZrT6jvQ';


            var map = L.mapbox.map('map', '', {
                attributionControl: false,
                maxBounds:[ [-90, -180], [90, 180] ],
                minZoom: 3
              }).setView([20, 35], 3);

            /*
                var map = L.mapbox.map('map')
                .setView([38.97416, -95.23252], 15);
            */

            // Use styleLayer to add a Mapbox style created in Mapbox Studio
            var baseLayer = L.mapbox.styleLayer('mapbox://styles/hiu/cit0gm97500012ypfwnzijj6o',{
              minZoom: 1,
              maxZoom: 16,
              scrollWheelZoom: true,
              zoomControl: false // we'll add later
            }).addTo(map);

            map.zoomControl.setPosition('topright');

            var topoLayer = new L.TopoJSON()

            $.getJSON('{{ site.baseurl }}/localdata/bureau_outline_topojson5.json')
              .done(addTopoData);


            //taken from: http://leafletjs.com/examples/choropleth-example.html
            //info box that contains title
            var info = L.control({position: 'bottomright'});



            var sidebar = L.control.sidebar('sidebar').addTo(map);



            info.onAdd = function (map) {
              this._div = L.DomUtil.create('div', 'info');
              this._div.innerHTML = '<div id="earth" data-toggle="tooltip" data-placement="left" title="Hello This Will Have Some Value"></div>';
              return this._div;
            };

            info.addTo(map);

            //This enables when a user clicks on part of the map that
            //is not part of a layer, it will zoom back into the 
            //original extent
            map.on('click', function(e) {        
                map.setView([14, 29], 3, {animation: true});
                map.removeLayer(products);
            });

            function addTopoData(topoData){  
              topoLayer.addData(topoData);
              topoLayer.addTo(map);
              topoLayer.eachLayer(handleLayer);
            }

            function handleLayer(layer){  
                //var randomValue = Math.random(),
                //fillColor = colorScale(randomValue).hex();
                var fillColor;

                console.log(layer.feature.properties.RegBureau);

                switch (layer.feature.properties.RegBureau) {
                 case "AF":
                    fillColor = "#0A2E52";
                    break;
                 case "EAP":
                    fillColor = "#0A2E52";
                    break;
                 case "EUR":
                    fillColor = "#0A2E52";
                    break;
                 case "NEA":
                    fillColor = "#0A2E52";
                    break;
                 case "SCA":
                    fillColor = "#0A2E52";
                    break;
                 case "WHA":
                    fillColor = "#0A2E52";
                    break;
                 default:
                    fillColor = "#b3b3b3";
                }

                layer.setStyle({
                    fillColor : fillColor,
                    fillOpacity:0,
                    color:fillColor,
                    weight:0,
                    opacity:0
                    });

                  layer.on({
                    mouseover: enterLayer,
                    mouseout: leaveLayer,
                    click: clickLayer,
                  });
                }

                var $tooltip = $('.country-name');

                function enterLayer(){  
                  var countryName = this.feature.properties.RegBureau;
                  $tooltip.text(countryName).show();

                  this.bringToFront();

                  switch (this.feature.properties.RegBureau) {
                     case "AF":
                        fillColor = "#fc944f";
                        break;
                     case "EAP":
                        fillColor = "#fced8d";
                        break;
                     case "EUR":
                        fillColor = "#eeb3cb";
                        break;
                     case "NEA":
                        fillColor = "#b8d773";
                        break;
                     case "SCA":
                        fillColor = "#b5aed6";
                        break;
                     case "WHA":
                        fillColor = "#a8c8e9";
                        break;
                     default:
                        fillColor = "#b3b3b3";
                  }

                  this.setStyle({
                    fillColor : fillColor,
                    fillOpacity:0.5,
                    color:fillColor,
                    weight:0,
                    opacity: 0
                  });
                }

                function leaveLayer(){  
                  $tooltip.hide();

                  switch (this.feature.properties.RegBureau) {
                     case "USA":
                        fillColor = "#b3b3b3";
                        break;
                     default:
                        fillColor = "#0A2E52";
                  }

                  this.bringToBack();

                  this.setStyle({
                    fillColor : fillColor,
                    fillOpacity:0,
                    color: fillColor,
                    weight:0,
                    opacity:0
                  });
            }

            // Products GeoJSON
            var productIcon = L.icon({
                iconUrl: "{{ site.baseurl }}/assets/img/mapgive_blue_pt.png",
                iconSize: [30, 45],
                iconAnchor: [15, 40],
                popupAnchor: [0, 0]
            });

            //need to declare outside function so it can be made into a layer and later deleted whenever a 
            //different region is clicked on
            var products;

            function getProducts(region_id) {

              var counter = 0;

              $.ajax({
                dataType: "json",
                url: "{{ site.baseurl}}/products/products.json",
                success: function(response) {
                        products = L.geoJson(response, {
                        zIndex: 99,
                        onEachFeature: function(feature, layer) {
                            counter++;
                            var popupOptions = {maxWidth: 200};
                            layer.setIcon(productIcon);
                            var popupContent = '<h4><a href="'+feature.properties.url+'">'+feature.properties.title+"</a></h4><br>Date Published: "+feature.properties.date_published+'<br>Region: <a href="{{ site.baseurl }}/regions/'+feature.properties.region_id+'">'+feature.properties.region_title+'</a><br><a href="'+feature.properties.pdf+'">Download</a>';
                            layer.bindPopup(popupContent, popupOptions);
                        },
                        filter: function (feature) {

                          if (feature.properties.region_id === region_id) return true
                        }
                    });

                    map.addLayer(products);

                    console.log("1st counter: ");
                    console.log(counter);

                    //return counter;

                    console.log("region id: ");
                    console.log(region_id);

                    $( '.product').remove();

                    $( '#'+ region_id.toLowerCase() +'_label' ).append( "<center><p class='product' >" + counter + "&nbspProducts</p></center>" );

                    //products.addTo(map);

                    //geojsonLayers.push(products);
                    //geojsonLayers = sortLayers(geojsonLayers)
                    //updateRenderOrder(geojsonLayers);
                    //layerswitcher.append(createLink(map, products, 'Products', products.options.zIndex));
                }
              });
            }

            var AFIcon = L.divIcon({  
              className: "my-div-icon",
              html: "<div class='mapgive-font region_label' id='af_label' >Africa</div>"
            });

            var EAPIcon = L.divIcon({ 
              className: "my-div-icon", 
              html: "<div class='mapgive-font region_label' id='eap_label' ><center>East&nbsp;Asia and&nbsp;the Pacific</center></div>"
            });

            var EURIcon = L.divIcon({ 
              className: "my-div-icon", 
              html: "<div class='mapgive-font region_label' id='eur_label' ><center>Europe</center></div>"
            });

            var NEAIcon = L.divIcon({  
              className: "my-div-icon",
              html: "<div class='mapgive-font region_label' id='nea_label' >Near&nbsp;East</div>"
            });

            var SCAIcon = L.divIcon({  
              className: "my-div-icon",
              html: "<div class='mapgive-font region_label' id='sca_label' ><center>South&nbsp;and Central&nbsp;Asia</center></div>"
            });

            var WHAIcon = L.divIcon({  
              className: "my-div-icon",
              html: "<div class='mapgive-font region_label' id='wha_label' ><center>Western Hemisphere</center></div>"
            });


            // you can set .my-div-icon styles in CSS
            L.marker([7, 23], {icon: AFIcon}).addTo(map);
            L.marker([39, 102], {icon: EAPIcon}).addTo(map);
            L.marker([51, 18], {icon: EURIcon}).addTo(map);
            L.marker([28, 8], {icon: NEAIcon}).addTo(map);
            L.marker([47.5, 57.5], {icon: SCAIcon}).addTo(map);
            L.marker([-9, -63], {icon: WHAIcon}).addTo(map);


            function clickLayer() {
                // Assuming the clicked feature is a shape, not a point marker.

                console.log('click layer');
                console.log(this.feature.properties.RegBureau);

                var regionCoord;
                var regionZoom;

                switch (this.feature.properties.RegBureau) {
                 case "AF":
                    regionCoord = [-1, 23];
                    regionZoom = 4;
                    break;
                 case "EAP":
                    regionCoord = [28, 110];
                    regionZoom = 4;
                    break;
                 case "EUR":
                    regionCoord = [51, 22];
                    regionZoom = 4;
                    break;
                 case "NEA":
                    regionCoord = [28, 20];
                    regionZoom = 4;
                    break;
                 case "SCA":
                    regionCoord = [35, 57.5];
                    regionZoom = 4;
                    break;
                 case "WHA":
                    regionCoord = [-9, -63];
                    regionZoom = 4;
                    break;
                 default:
                    regionCoord = [14, -20];
                    regionZoom = 3;
                }


                if (typeof(products) != "undefined") {
                  console.log("products are defined");
                  products.clearLayers();
                }
                

                //map.fitBounds(this.getBounds());
                map.setView(regionCoord,regionZoom);

                //console.log(this.feature);
                //console.log(this.feature.properties.RegBureau);
                getProducts(this.feature.properties.RegBureau);
                //map.setView(event.latlng, 5);

            }

/*
            topoLayer.on("click", function (event) {
                // Assuming the clicked feature is a shape, not a point marker.
                map.fitBounds(event.layer.getBounds());
                //console.log(event.layer);
                //getProducts(event.layer.feature.properties.RegBureau);
                //map.setView(event.latlng, 5);
            });
*/

            //events
            var eventIcon = L.icon({
                iconUrl: "{{ site.baseurl }}/assets/img/mapgive_red_pt.png",
                iconSize: [30, 45],
                iconAnchor: [15, 40],
                popupAnchor: [0, 0]
            });

            $.ajax({
                dataType: "json",
                url: "{{ site.baseurl}}/events/events.json",
                success: function(response) {
                    var events = L.geoJson(response, {
                        zIndex: 100,
                        onEachFeature: function(feature, layer) {
                            var popupOptions = {maxWidth: 200};
                            layer.setIcon(eventIcon);
                            var popupContent = '<h4><a href="'+feature.properties.url+'">'+feature.properties.title+'</a></h4>';
                            layer.bindPopup(popupContent, popupOptions);
                        }
                    });
                    events.addTo(map);
                    //geojsonLayers.push(events);
                    //geojsonLayers = sortLayers(geojsonLayers)
                    //updateRenderOrder(geojsonLayers);
                    //layerswitcher.append(createLink(map, events, 'Events', events.options.zIndex));
                }
            });



   }());
</script>
