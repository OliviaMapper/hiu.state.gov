---
layout: map
title: "HIU"

tilelayers:
  - id: "hiu.nbk3c19e,hiu.lp5bfbt9"
    type: "mapbox"
    attribution: "Names and boundary representation are not necessarily authoritative."
    description: "On the fly composite of MapBox satellite with LSIB boundaries"
    zIndex: 18

layerswitcher:
  

---

<!--
<nav id='menu-ui' class='menu-ui'></nav>
-->

<!--disables scroll bar-->
<style type="text/css">
body {
    overflow:hidden;
}
</style>

<div id="map" style="top:0px;left:0px;width:100%;height:100%;"></div>
<div class="bureau-name"></div>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="https://d3js.org/d3.v3.min.js"></script>
<script src="https://d3js.org/topojson.v1.min.js"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>


<script>
    L.TopoJSON = L.GeoJSON.extend({  
      addData: function(jsonData) {    
        if (jsonData.type === "Topology") {
          for (key in jsonData.objects) {
            geojson = topojson.feature(jsonData, jsonData.objects[key]);
            L.GeoJSON.prototype.addData.call(this, geojson);
          }
        }    
        else {
          L.GeoJSON.prototype.addData.call(this, jsonData);
        }
      }  
    });
</script>


<script>

    (function(){



            var layerswitcher = $('#menu-ui');

            //var map = L.map('map').setView([0, 30], 3);

            L.mapbox.accessToken = 'pk.eyJ1IjoiaGl1IiwiYSI6InJWNGZJSzgifQ.xK1ndT3W8XL9lwVZrT6jvQ';


            var map = L.mapbox.map('map', '', {
                attributionControl: false
              }).setView([14, 29], 3);

        /*
            var map = L.mapbox.map('map')
            .setView([38.97416, -95.23252], 15);
        */

            // Use styleLayer to add a Mapbox style created in Mapbox Studio
              var baseLayer = L.mapbox.styleLayer('mapbox://styles/hiu/ciprlds860017bakwf6yfa6f7',{
                minZoom: 1,
                maxZoom: 16,
                scrollWheelZoom: true,
                zoomControl: false // we'll add later
              }).addTo(map);


            var topoLayer = new L.TopoJSON()

            $.getJSON('bureau_outline_topojson3.json')
              .done(addTopoData);

            function addTopoData(topoData){  
              topoLayer.addData(topoData);
              topoLayer.addTo(map);
              topoLayer.eachLayer(handleLayer);
            }


            function handleLayer(layer){  
          //var randomValue = Math.random(),
            //fillColor = colorScale(randomValue).hex();
          var fillColor;

          console.log(layer.feature.properties.RegBureau);

          switch (layer.feature.properties.RegBureau) {
             case "AF":
                fillColor = "#ff6600";
                break;
             case "EAP":
                fillColor = "#ffff00";
                break;
             case "EUR":
                fillColor = "#ff66cc";
                break;
             case "NEA":
                fillColor = "#66ff66";
                break;
             case "SCA":
                fillColor = "#9900ff";
                break;
             case "WHA":
                fillColor = "#3399ff";
                break;
             default:
                fillColor = "#b3b3b3";
          }

          layer.setStyle({
            fillColor : fillColor,
            fillOpacity:0.2,
            color:'#000',
            weight:0.5,
            opacity:0.5
          });

          layer.on({
            mouseover: enterLayer,
            mouseout: leaveLayer
          });
        }

        var $tooltip = $('.country-name');

        function enterLayer(){  
          var countryName = this.feature.properties.RegBureau;
          $tooltip.text(countryName).show();

          this.bringToFront();
          this.setStyle({
            weight:2,
            opacity: 1
          });
        }

        function leaveLayer(){  
          $tooltip.hide();

          this.bringToBack();
          this.setStyle({
            weight:1,
            opacity:.5
          });
        }


        topoLayer.on("click", function (event) {
            // Assuming the clicked feature is a shape, not a point marker.
            //map.fitBounds(event.layer.getBounds());
            map.setView(event.latlng, 5);
        });

            // Products GeoJSON
            var productIcon = L.icon({
                iconUrl: "{{ site.baseurl }}/assets/img/mapgive_blue_pt.png",
                iconSize: [30, 45],
                iconAnchor: [15, 40],
                popupAnchor: [0, 0]
            });
            $.ajax({
                dataType: "json",
                url: "{{ site.baseurl}}/products/products.json",
                success: function(response) {
                    var products = L.geoJson(response, {
                        zIndex: 99,
                        onEachFeature: function(feature, layer) {
                            var popupOptions = {maxWidth: 200};
                            layer.setIcon(productIcon);
                            var popupContent = '<h4><a href="'+feature.properties.url+'">'+feature.properties.title+"</a></h4><br>Date Published: "+feature.properties.date_published+'<br>Region: <a href="{{ site.baseurl }}/regions/'+feature.properties.region_id+'">'+feature.properties.region_title+'</a><br><a href="'+feature.properties.pdf+'">Download</a>';
                            layer.bindPopup(popupContent, popupOptions);
                        }
                    });
                    products.addTo(map);
                    geojsonLayers.push(products);
                    geojsonLayers = sortLayers(geojsonLayers)
                    updateRenderOrder(geojsonLayers);
                    layerswitcher.append(createLink(map, products, 'Products', products.options.zIndex));
                }
            });


            //events
            var eventIcon = L.icon({
                iconUrl: "{{ site.baseurl }}/assets/img/mapgive_red_pt.png",
                iconSize: [30, 45],
                iconAnchor: [15, 40],
                popupAnchor: [0, 0]
            });

            $.ajax({
                dataType: "json",
                url: "{{ site.baseurl}}/events/events.json",
                success: function(response) {
                    var events = L.geoJson(response, {
                        zIndex: 100,
                        onEachFeature: function(feature, layer) {
                            var popupOptions = {maxWidth: 200};
                            layer.setIcon(eventIcon);
                            var popupContent = '<h4><a href="'+feature.properties.url+'">'+feature.properties.title+'</a></h4>';
                            layer.bindPopup(popupContent, popupOptions);
                        }
                    });
                    events.addTo(map);
                    geojsonLayers.push(events);
                    geojsonLayers = sortLayers(geojsonLayers)
                    updateRenderOrder(geojsonLayers);
                    layerswitcher.append(createLink(map, events, 'Events', events.options.zIndex));
                }
            });



   }());
</script>
