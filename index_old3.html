---
layout: map
title: "HIU"

tilelayers:
  - id: "hiu.nbk3c19e,hiu.lp5bfbt9"
    type: "mapbox"
    attribution: "Names and boundary representation are not necessarily authoritative."
    description: "On the fly composite of MapBox satellite with LSIB boundaries"
    zIndex: 18

layerswitcher:
  
---

<link rel="stylesheet" href="{{ site.baseurl }}/lib/font-awesome-4.6.3/css/font-awesome.min.css" type="text/css" media="all" />

<link rel="stylesheet" href="{{ site.baseurl }}/lib/leaflet-sidebar/leaflet-sidebar.css" type="text/css" media="all" />

<link rel="stylesheet" href="{{ site.baseurl }}/lib/leaflet-list-markers/dist/leaflet-list-markers.src.css" type="text/css" media="all" />

<script src="{{ site.baseurl }}/lib/leaflet-list-markers/dist/leaflet-list-markers.src.js"></script>


<script src="{{ site.baseurl }}/lib/leaflet-markercluster/leaflet.markercluster.js"></script>
<link rel="stylesheet" href="{{ site.baseurl }}/lib/leaflet-markercluster/MarkerCluster.css" />
<link rel="stylesheet" href="{{ site.baseurl }}/lib/leaflet-markercluster/MarkerCluster.Default.css"  />

<!--disables scroll bar-->
<style type="text/css">
body {
    overflow:hidden;
}
.region_label {
  color: #0A2E52;
  color: #808284;
/*
  background: rgba(255,255,255,0.8);
  background: #808284;

  box-shadow: 0 0 15px rgba(0,0,0,0.2);
  border-radius: 5px;
*/
  padding: 4px 4px 4px 4px;
  display: inline-block
}


body {
  background-color: black;
}

#earth {
  width: 80px;
  height: 80px;
  background: url(http://www.noirextreme.com/digital/Earth-Color4096.jpg);
  border-radius: 50%;
  background-size: 210px;
  box-shadow: inset 16px 0 40px 6px rgb(0, 0, 0),
    inset -3px 0 6px 2px rgba(255, 255, 255, 0.2);
}

@keyframes rotate {
  from { background-position-x: 0px; }
  to { background-position-x: 210px; }
}

#earth:hover{
    -webkit-border-radius: 10px;
    -moz-border-radius: 10px;
    border-radius: 50%;
    -webkit-box-shadow: 0px 0px 30px 0px rgba(0, 255, 0, 0.67);
    -moz-box-shadow:    0px 0px 30px 0px rgba(0, 255, 0, 0.67);
    box-shadow:         0px 0px 30px 0px rgba(0, 255, 0, 0.67);
}

.info {
  padding: 6px 8px 25px;
  font: 14px/16px Arial, Helvetica, sans-serif;
  border-radius: 5px;
}
.info h4 {
  margin: 0 0 5px;
  color: #d73f3f;
}

.sidebar-tall {
  height: 89%; 
}

.leaflet-container .list-markers {
  visibility: hidden;
}

.item {
  display:block;
  border-bottom:1px solid #eee;
  padding:10px;
  text-decoration:none;
}

.item.active {
    background-color: #d1d6d1;
}

.title {
    display: block;
    color: #0A2E52;
    font-weight: 700;
}

.item > .title {
    display: block;
    color: #0A2E52;
    font-weight: 700;
}

.item > .title:hover {
    color: #337ab7;
}

a.title {
    text-decoration: none;
}

a.title:hover {
    text-decoration: none;
}

.container2 {
    width:100%;
    height: 160px;
    padding:1%;
}

.description-image {
    float: left;
    height: 175px;
    width: 165px;
}

.description-text {
    float: left;
    padding-top: 5px;
    height: 175px;
    width: 150px;
}

.listitem-thumbnail {
    display: inline-block;
    color: white;
    font-size: 24px;
}

.listitem-thumbnail:hover div {
    opacity: 0.8;
    transition: opacity 0.4s ease-in-out;
}

#img-container {
  position: relative;
}

#preview {
   position: absolute;
   top: 0px;
   left: 0px;
   width: 150px;
   text-align: center;
   opacity: 0;
}

#preview:hover {
   color: white;
   opacity: 1;
   transition: opacity 0.4s ease-in-out;
}

#hover {
   position: absolute;
   top: 0px;
   left: 0px;
   height:150px;
   width:150px;
}

#hover:hover {
   color:black;
   background-color: black;
   opacity: .7;
   transition: opacity 0.4s ease-in-out;
}

/* icon css */
.circleBase {
    border-radius: 50%;
    behavior: url(PIE.htc); /* remove if you don't care about IE8 */
}

.type1 {
    width: 20px;
    height: 20px;
    background: white;
    border: 4px solid #337ab7;
    opacity: 1;
    margin-left: -4px;
    margin-top: -4px;
}

</style>


<!--<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="https://d3js.org/d3.v3.min.js"></script>
<script src="https://d3js.org/topojson.v1.min.js"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>-->

<script src="{{ site.baseurl }}/lib/d3/d3.v3.min.js"></script>
<script src="{{ site.baseurl }}/lib/d3/topojson.v1.min.js"></script>
<script src="{{ site.baseurl }}/lib/queue/queue.v1.min.js"></script>


<!-- Modals from Bootstrap, used to preview images when thumbnails clicked -->
<!-- http://getbootstrap.com/javascript/#modals -->
<!-- giving a z-index of 2050 to be on top of sidebar -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="z-index: 2050;">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel"></h4>
      </div>
      <div class="modal-body">
        <img id="modal-img" >
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!--style="height: calc(100% - 61px); position:relative;"-->
    <div id="sidebar" class="sidebar" style="margin-top: 60px;">
          <!-- Nav tabs -->
          <div class="sidebar-tabs">
              <ul role="tablist">
                  <li class="active">
                    <a href="#home" id="home" role="tab"><i class="fa fa-bars"></i></a>
                  </li>
                  <li>
                    <a href="#AF" id="AF" role="tab">AF</a>
                  </li>
                  <li>
                    <a href="#EAP" id="EAP" role="tab">EAP</a>
                  </li>
                  <li>
                    <a href="#EUR" id="EUR" role="tab">EUR</a>
                  </li>
                  <li>
                    <a href="#NEA" id="NEA" role="tab">NEA</a>
                  </li>
                  <li>
                    <a href="#SCA" id="SCA" role="tab">SCA</a>
                  </li>
                  <li>
                    <a href="#WHA" id="WHA" role="tab">WHA</a>
                  </li>
                  <li>
                    <a href="#global" id="global" role="tab"><i class="fa fa-globe" style="font-size: 20px;"></i></a>
                  </li>
                  <!-- potentially can have an e-mail symbol,search, or twitter symbol
                  <li class="disabled">
                    <a href="#messages" role="tab"><i class="fa fa-envelope"></i></a>
                  </li>
                  -->
              </ul>
              <!--
              <ul role="tablist">
                  <li><a href="#settings" role="tab"><i class="fa fa-gear"></i></a></li>
              </ul>
              -->
          </div>

              <!-- Tab panes -->
          <div class="sidebar-content">


            <div class="sidebar-container active" id="home">

              <div class="header-contain-div">
                <h1 class="sidebar-header">
                    Humanitarian Information Unit (HIU)
                    <span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
                </h1>
              </div>

              <div class="sidebar-pane active" id="home" style="overflow-y: scroll;height: 100%;">

                    <div class="scroll">

                        <div id='hiu-tab' class='hiu-tab'>

                          <p>The HIU serves as a U.S. Government interagency center to identify, collect, analyze, and disseminate all-source information critical to U.S. Government decision-makers and partners in preparation for and response to humanitarian emergencies worldwide, and to promote innovative technologies and best practices for humanitarian information management.</p>

                          <p><b>Select different regions on the map or on the sidebar tabs to view our products</b></p>

                        </div>

                        <div id='product-listings' class='product-listings'></div>

                     </div>

                </div>

            </div>

            <div class="sidebar-container" id="AF">

              <div class="header-contain-div">
                <h1 class="sidebar-header" id="AF">Africa<span class="sidebar-close">
                    <i class="fa fa-caret-left"></i></span>
                  </h1>
              </div>

              <div class="sidebar-pane active" id="AF" style="overflow-y: scroll;height: 97%;">
                  <div class='region-product-count' id='AF' ></div>

                  <div id='AF-listings' class='AF-listings'></div>

              </div>

            </div>

            <div class="sidebar-container" id="EAP">

              <div class="header-contain-div">
                <h1 class="sidebar-header" id="EAP">East Asia and the Pacific<span class="sidebar-close">
                    <i class="fa fa-caret-left"></i></span>
                  </h1>
              </div>

              <div class="sidebar-pane active" id="EAP" style="overflow-y: scroll;height: 97%;">
                  <div class='region-product-count' id='EAP' ></div>

                  <div id='EAP-listings' class='EAP-listings'></div>

              </div>

            </div>

            <div class="sidebar-container" id="EUR">

              <div class="header-contain-div">
                <h1 class="sidebar-header" id="EUR">Europe<span class="sidebar-close">
                    <i class="fa fa-caret-left"></i></span>
                  </h1>
              </div>

              <div class="sidebar-pane active" id="EUR" style="overflow-y: scroll;height: 97%;">
                  <div class='region-product-count' id='EUR' ></div>

                  <div id='EUR-listings' class='EUR-listings'></div>

              </div>

            </div>

            <div class="sidebar-container" id="NEA">

              <div class="header-contain-div">
                <h1 class="sidebar-header" id="NEA">Near East<span class="sidebar-close">
                    <i class="fa fa-caret-left"></i></span>
                  </h1>
              </div>

              <div class="sidebar-pane active" id="NEA" style="overflow-y: scroll;height: 97%;">
                  <div class='region-product-count' id='NEA' ></div>

                  <div id='NEA-listings' class='NEA-listings'></div>

              </div>

            </div>

            <div class="sidebar-container" id="SCA">

              <div class="header-contain-div">
                <h1 class="sidebar-header" id="SCA">South and Central Asia<span class="sidebar-close">
                    <i class="fa fa-caret-left"></i></span>
                  </h1>
              </div>

              <div class="sidebar-pane active" id="SCA" style="overflow-y: scroll;height: 97%;">
                  <div class='region-product-count' id='SCA' ></div>

                  <div id='SCA-listings' class='SCA-listings'></div>

              </div>

            </div>

            <div class="sidebar-container" id="WHA">

              <div class="header-contain-div">
                <h1 class="sidebar-header" id="WHA">Western Hemisphere<span class="sidebar-close">
                    <i class="fa fa-caret-left"></i></span>
                  </h1>
              </div>

              <div class="sidebar-pane active" id="WHA" style="overflow-y: scroll;height: 97%;">
                  <div class='region-product-count' id='WHA' ></div>

                  <div id='WHA-listings' class='WHA-listings'></div>

              </div>

            </div>

            <div class="sidebar-container" id="global">

              <div class="header-contain-div">
                <h1 class="sidebar-header" id="global">Global Products<span class="sidebar-close">
                    <i class="fa fa-caret-left"></i></span>
                  </h1>
              </div>

              <div class="sidebar-pane active" id="global" style="overflow-y: scroll;height: 97%;">
                  <div class='region-product-count' id='global' ></div>

                  <div id='global-listings' class='global-listings'></div>

              </div>

            </div>



              <!--
              <div class="sidebar-pane" id="settings">
                  <h1 class="sidebar-header">Settings<span class="sidebar-close">
                    <i class="fa fa-caret-left"></i></span>
                  </h1>
              </div>
              -->

          </div>
      </div>


<div id="map" class="sidebar-map" style="top:0px;left:0px;width:100%;height:100%;height: 92%;"></div>

<script src="{{ site.baseurl }}/lib/leaflet-sidebar/leaflet-sidebar.js"></script>

<div class="bureau-name"></div>

<script>
    L.TopoJSON = L.GeoJSON.extend({  
      addData: function(jsonData) {    
        if (jsonData.type === "Topology") {
          for (key in jsonData.objects) {
            geojson = topojson.feature(jsonData, jsonData.objects[key]);
            L.GeoJSON.prototype.addData.call(this, geojson);
          }
        }    
        else {
          L.GeoJSON.prototype.addData.call(this, jsonData);
        }
      }  
    });
</script>


<script>

//Sets a window activeListingID variable, the leaslet-list-markers.src.js script uses
//this to keep a product item selected
    window.activeListingID = 'none';

//This resets the activeListingID if the home tab is selected
    $('#home').click(function() {
      activeListingID = 'none1';
    });

    window.selectedID = 'none';

    (function(){

            var layerswitcher = $('#menu-ui');

            //var map = L.map('map').setView([0, 30], 3);

            //L.mapbox.accessToken = 'pk.eyJ1IjoiaGl1IiwiYSI6InJWNGZJSzgifQ.xK1ndT3W8XL9lwVZrT6jvQ';

            //need to make map a window variable to make it seen in leaflet-list-markers.src.js
            //probably because all of this in inside of its own contained function
            window.map = L.map('map', {
                attributionControl: {collapsed: true},
                maxBounds:[ [-90, -140], [100, 180] ],
                minZoom: 3
              }).setView([20, 25], 3);

            // Use styleLayer to add a Mapbox style created in Mapbox Studio
            var baseLayer = L.tileLayer('https://api.mapbox.com/styles/v1/hiu/cit0gm97500012ypfwnzijj6o/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiaGl1IiwiYSI6InJWNGZJSzgifQ.xK1ndT3W8XL9lwVZrT6jvQ',{
              minZoom: 1,
              maxZoom: 16,
              scrollWheelZoom: true,
              zoomControl: false,
              attribution: 'Names and boundary representation are not necessarily authoritative'
            }).addTo(map);

            //http://leafletjs.com/examples/map-panes/
            map.createPane('labels');
            map.getPane('labels').style.zIndex = 550;
            map.getPane('labels').style.pointerEvents = 'none';


            var Labels = L.tileLayer('https://api.mapbox.com/styles/v1/hiu/ciua29cno001p2imv942m1kfv/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiaGl1IiwiYSI6InJWNGZJSzgifQ.xK1ndT3W8XL9lwVZrT6jvQ', {
              pane: 'labels'
            }).addTo(map);



            map.zoomControl.setPosition('topright');

            var topoLayer = new L.TopoJSON()

            $.getJSON('{{ site.baseurl }}/localdata/bureau_outline_topojson5.json')
              .done(addTopoData);


            //taken from: http://leafletjs.com/examples/choropleth-example.html
            //info box that contains title
            var info = L.control({position: 'bottomright'});

            window.sidebar = L.control.sidebar('sidebar').addTo(map);


/*
            info.onAdd = function (map) {
              this._div = L.DomUtil.create('div', 'info');
              this._div.innerHTML = '<div id="earth" data-toggle="tooltip" data-placement="left" title="Hello This Will Have Some Value"></div>';
              return this._div;
            };

            info.addTo(map);
*/


            var AFmarkers = new L.MarkerClusterGroup();
            var EAPmarkers = new L.MarkerClusterGroup();
            var EURmarkers = new L.MarkerClusterGroup();
            var NEAmarkers = new L.MarkerClusterGroup();
            var SCAmarkers = new L.MarkerClusterGroup();
            var WHAmarkers = new L.MarkerClusterGroup();

            var markers2 = new L.MarkerClusterGroup();

            var AFcount = 1;
            var EAPcount = 1;
            var EURcount = 1;
            var NEAcount = 1;
            var SCAcount = 1;
            var WHAcount = 1;

            var layerClicked = false;

            window.activeLayer = 'none';

            var firstClick = true;

            console.log('active layer: ');
            console.log(activeLayer);

            console.log('layerClicked val 1st');
            console.log(layerClicked);



            //This enables when a user clicks on part of the map that
            //is not part of a layer, it will zoom back into the 
            //original extent
            map.on('click', function(e) {        
                //The TopoJson layer click function always fires first

                map.setView([20, 25], 3, {animation: false});
                console.log('map clicked');
                console.log(e);

                console.log('layerClicked val 2nd');
                console.log(layerClicked);

                if(layerClicked !== true){
                  //$('.sidebar').css({ "height": "33%"});
                  $('.sidebar').removeClass("sidebar-tall");
                  activeLayer = 'none';

                  sidebar.open('home');
                }

                layerClicked = false;

                $( '.product').remove();

                map.removeLayer(AFmarkers);
                map.removeLayer(EAPmarkers);
                map.removeLayer(EURmarkers);
                map.removeLayer(NEAmarkers);
                map.removeLayer(SCAmarkers);
                map.removeLayer(WHAmarkers);

                $('.hiu-tab').show();

                //$('.item.active').removeClass('active');

                //console.log('testing section');
                //console.log($('.item.active'));
                
            });

            function addTopoData(topoData){  
              topoLayer.addData(topoData);
              topoLayer.addTo(map);
              topoLayer.eachLayer(handleLayer);
            }

            function handleLayer(layer){  
                //var randomValue = Math.random(),
                //fillColor = colorScale(randomValue).hex();
                var fillColor;

                //console.log(layer.feature.properties.RegBureau);

                switch (layer.feature.properties.RegBureau) {
                 case "AF":
                    fillColor = "#0A2E52";
                    break;
                 case "EAP":
                    fillColor = "#0A2E52";
                    break;
                 case "EUR":
                    fillColor = "#0A2E52";
                    break;
                 case "NEA":
                    fillColor = "#0A2E52";
                    break;
                 case "SCA":
                    fillColor = "#0A2E52";
                    break;
                 case "WHA":
                    fillColor = "#0A2E52";
                    break;
                 default:
                    fillColor = "#b3b3b3";
                }

                layer.setStyle({
                    fillColor : fillColor,
                    fillOpacity:0,
                    color:fillColor,
                    weight:0,
                    opacity:0
                    });

                  layer.on({
                    mouseover: enterLayer,
                    mouseout: leaveLayer,
                    click: clickLayer,
                  });
                }

                var $tooltip = $('.country-name');

                function enterLayer(){  
                  var countryName = this.feature.properties.RegBureau;
                  $tooltip.text(countryName).show();

                  this.bringToFront();

                  switch (this.feature.properties.RegBureau) {
                     case "AF":
                        fillColor = "#fc944f";
                        break;
                     case "EAP":
                        fillColor = "#fced8d";
                        break;
                     case "EUR":
                        fillColor = "#eeb3cb";
                        break;
                     case "NEA":
                        fillColor = "#b8d773";
                        break;
                     case "SCA":
                        fillColor = "#b5aed6";
                        break;
                     case "WHA":
                        fillColor = "#a8c8e9";
                        break;
                     default:
                        fillColor = "#b3b3b3";
                  }

                  this.setStyle({
                    fillColor : fillColor,
                    fillOpacity:0.5,
                    color:fillColor,
                    weight:0,
                    opacity: 0
                  });
                }

                function leaveLayer(){  
                  $tooltip.hide();

                  switch (this.feature.properties.RegBureau) {
                     case "USA":
                        fillColor = "#b3b3b3";
                        break;
                     default:
                        fillColor = "#0A2E52";
                  }

                  this.bringToBack();

                  this.setStyle({
                    fillColor : fillColor,
                    fillOpacity:0,
                    color: fillColor,
                    weight:0,
                    opacity:0
                  });
            }

            // Products GeoJSON
            /* old picture icon 
            var productIcon = L.icon({
                iconUrl: "{{ site.baseurl }}/assets/img/mapgive_blue_pt.png",
                iconSize: [30, 45],
                iconAnchor: [15, 40],
                popupAnchor: [0, 0]
            });
            */

            var productIcon = L.divIcon({
                className: 'product-icon',
                html: '<div class="circleBase type1"></div>'
            });

            function getProducts(region_id,regionCoord,regionZoom) {

              var myLayer = L.featureGroup()

              $.ajax({
                dataType: "json",
                url: "{{ site.baseurl}}/products/products.json",
                success: function(response) {
                    var products = L.geoJson(response, {
                        zIndex: 100,
                        onEachFeature: function(feature, layer) {
                            //var title = layer.feature.properties.title;
                        }
                    });


                    $('.product-listings').empty();


                    console.log('first click');
                    console.log(firstClick);

                    if(firstClick == true){
                      map.addControl( new L.Control.ListMarkers({layer: products}) );
                      firstClick = false;
                    }

                    window.map.setView(regionCoord,regionZoom);

                    var enabled = {};

                    var featureCollection = products;

                    //console.log('features:');
                    //console.log(featureCollection._layers);

                    for (var i in featureCollection._layers) {
                      //console.log('feature:');
                      //console.log(featureCollection._layers[i].feature);

                      if (featureCollection._layers[i].feature.properties.region_id === region_id) {

                          //enabled[featureCollection._layers[i].feature.properties.title] = true;

                          var popupContent = '<div class="title">'+featureCollection._layers[i].feature.properties.title+'</div>';

                          var popupOptions = {keepInView: true,maxWidth: 200};

                          var altString = featureCollection._layers[i].feature.properties.title;

                          var marker = L.marker(new L.LatLng(featureCollection._layers[i].feature.geometry.coordinates[1],featureCollection._layers[i].feature.geometry.coordinates[0]), {
                                                      icon: productIcon, alt: altString
                                                  });

                          marker.bindPopup(popupContent,popupOptions);

                          switch (region_id) {
                                         case "AF":
                                          if (AFcount == 1) {
                                            AFmarkers.addLayer(marker);
                                          }
                                            break;
                                         case "EAP":
                                          if (EAPcount == 1) {
                                            EAPmarkers.addLayer(marker);
                                          }
                                            break;
                                         case "EUR":
                                          if (EURcount == 1) {
                                            EURmarkers.addLayer(marker);
                                          }
                                            break;
                                         case "NEA":
                                          if (NEAcount == 1) {
                                            NEAmarkers.addLayer(marker);
                                          }
                                            break;
                                         case "SCA":
                                          if (SCAcount == 1) {
                                            SCAmarkers.addLayer(marker);
                                          }
                                            break;
                                         case "WHA":
                                          if (WHAcount == 1) {
                                            WHAmarkers.addLayer(marker);
                                          }
                                            break;
                                         default:
                                        }
                          }                      
                        }


                        /*

                        console.log("AF length ");
                        console.log(AFmarkers.getLayers().length);
                        console.log(AFmarkers.getLayers());

                        templayerGroup = L.LayerGroup();

                        for (var i = 0; i < AFmarkers.getLayers().length; i++) {
                          console.log(AFmarkers.getLayers()[i]);
                          tempLayer = AFmarkers.getLayers()[i];
                          templayerGroup.addLayer(tempLayer);
                        }
                        */

                        //console.log('templayerGroup val:');
                        //console.log(templayerGroup);

                        AFmarkers.on("click", function (event) {
                            var clickedMarker = event.layer;
                            console.log('AF icon fired on click: ');
                            console.log(event.layer.options.alt);

                            //sample1 = "Democratic Republic of Congo: Presence at Mine Sites of Armed Groups and other Entities"

                            clickedMarkerTitle = event.layer.options.alt;

                            console.log('sample title');
                            //console.log($('.item').attr('title'));
                            console.log($('.item[title="'+clickedMarkerTitle+'"]'));
                            $('.item').removeClass('active');
                            $('.item[title="'+clickedMarkerTitle+'"]').addClass('active');

                            selectedID = $('.item[title="'+clickedMarkerTitle+'"]').attr('id');

                            var parentClass = $('.item[id="'+selectedID+'"]').parent().attr('class');

                            $('.'+parentClass).prepend($('.item[title="'+clickedMarkerTitle+'"]'));
                        });

                        EAPmarkers.on("click", function (event) {
                            var clickedMarker = event.layer;
                            clickedMarkerTitle = event.layer.options.alt;
                            $('.item').removeClass('active');
                            $('.item[title="'+clickedMarkerTitle+'"]').addClass('active');

                            selectedID = $('.item[title="'+clickedMarkerTitle+'"]').attr('id');

                            var parentClass = $('.item[id="'+selectedID+'"]').parent().attr('class');

                            $('.'+parentClass).prepend($('.item[title="'+clickedMarkerTitle+'"]'));
                        });

                        EURmarkers.on("click", function (event) {
                            var clickedMarker = event.layer;
                            clickedMarkerTitle = event.layer.options.alt;
                            $('.item').removeClass('active');
                            $('.item[title="'+clickedMarkerTitle+'"]').addClass('active');

                            selectedID = $('.item[title="'+clickedMarkerTitle+'"]').attr('id');

                            var parentClass = $('.item[id="'+selectedID+'"]').parent().attr('class');

                            $('.'+parentClass).prepend($('.item[title="'+clickedMarkerTitle+'"]'));
                        });

                        NEAmarkers.on("click", function (event) {
                            var clickedMarker = event.layer;
                            clickedMarkerTitle = event.layer.options.alt;
                            $('.item').removeClass('active');

                            $('.item[title="'+clickedMarkerTitle+'"]').addClass('active');

                            selectedID = $('.item[title="'+clickedMarkerTitle+'"]').attr('id');

                            var parentClass = $('.item[id="'+selectedID+'"]').parent().attr('class');

                            $('.'+parentClass).prepend($('.item[title="'+clickedMarkerTitle+'"]'));
                        });

                        SCAmarkers.on("click", function (event) {
                            var clickedMarker = event.layer;
                            clickedMarkerTitle = event.layer.options.alt;
                            $('.item').removeClass('active');
                            $('.item[title="'+clickedMarkerTitle+'"]').addClass('active');

                            selectedID = $('.item[title="'+clickedMarkerTitle+'"]').attr('id');

                            var parentClass = $('.item[id="'+selectedID+'"]').parent().attr('class');

                            $('.'+parentClass).prepend($('.item[title="'+clickedMarkerTitle+'"]'));
                        });

                        WHAmarkers.on("click", function (event) {
                            var clickedMarker = event.layer;
                            clickedMarkerTitle = event.layer.options.alt;
                            $('.item').removeClass('active');
                            $('.item[title="'+clickedMarkerTitle+'"]').addClass('active');

                            selectedID = $('.item[title="'+clickedMarkerTitle+'"]').attr('id');

                            var parentClass = $('.item[id="'+selectedID+'"]').parent().attr('class');

                            $('.'+parentClass).prepend($('.item[title="'+clickedMarkerTitle+'"]'));
                        });

/*
                        var _markerOnClick = function(e) {
                            console.log('icon fired on click: ');
                            console.log(this);
                        }

                        .addEventListener('click', _markerOnClick)

                        L.marker([5.482575, 26.501904], {icon: AFIcon}).addTo(map);
*/

                        switch (region_id) {
                                       case "AF":
                                          map.removeLayer(EAPmarkers);
                                          map.removeLayer(EURmarkers);
                                          map.removeLayer(NEAmarkers);
                                          map.removeLayer(SCAmarkers);
                                          map.removeLayer(WHAmarkers);
                                          map.addLayer(AFmarkers);
                                          $( '.product').remove();
                                          $( '#'+ region_id.toLowerCase() +'_label' ).append( "<center><p class='product' >" + AFmarkers.getLayers().length + "&nbspProducts</p></center>" );
                                          AFcount++;

                                          break;
                                       case "EAP":
                                          map.removeLayer(AFmarkers);
                                          map.removeLayer(EURmarkers);
                                          map.removeLayer(NEAmarkers);
                                          map.removeLayer(SCAmarkers);
                                          map.removeLayer(WHAmarkers);
                                          map.addLayer(EAPmarkers);
                                          $( '.product').remove();
                                          $( '#'+ region_id.toLowerCase() +'_label' ).append( "<center><p class='product' >" + EAPmarkers.getLayers().length + "&nbspProducts</p></center>" );
                                          EAPcount++;
                                          break;
                                       case "EUR":
                                          map.removeLayer(AFmarkers);
                                          map.removeLayer(EAPmarkers);
                                          map.removeLayer(NEAmarkers);
                                          map.removeLayer(SCAmarkers);
                                          map.removeLayer(WHAmarkers);
                                          map.addLayer(EURmarkers);
                                          $( '.product').remove();
                                          $( '#'+ region_id.toLowerCase() +'_label' ).append( "<center><p class='product' >" + EURmarkers.getLayers().length + "&nbspProducts</p></center>" );
                                          EURcount++;
                                          break;
                                       case "NEA":
                                          map.removeLayer(AFmarkers);
                                          map.removeLayer(EAPmarkers);
                                          map.removeLayer(EURmarkers);
                                          map.removeLayer(SCAmarkers);
                                          map.removeLayer(WHAmarkers);
                                          map.addLayer(NEAmarkers);
                                          $( '.product').remove();
                                          $( '#'+ region_id.toLowerCase() +'_label' ).append( "<center><p class='product' >" + NEAmarkers.getLayers().length + "&nbspProducts</p></center>" );
                                          NEAcount++;
                                          break;
                                       case "SCA":
                                          map.removeLayer(AFmarkers);
                                          map.removeLayer(EAPmarkers);
                                          map.removeLayer(EURmarkers);
                                          map.removeLayer(NEAmarkers);
                                          map.removeLayer(WHAmarkers);
                                          map.addLayer(SCAmarkers);
                                          $( '.product').remove();
                                          $( '#'+ region_id.toLowerCase() +'_label' ).append( "<center><p class='product' >" + SCAmarkers.getLayers().length + "&nbspProducts</p></center>" );
                                          SCAcount++;
                                          break;
                                       case "WHA":
                                          map.removeLayer(AFmarkers);
                                          map.removeLayer(EAPmarkers);
                                          map.removeLayer(EURmarkers);
                                          map.removeLayer(NEAmarkers);
                                          map.removeLayer(SCAmarkers);
                                          map.addLayer(WHAmarkers);
                                          $( '.product').remove();
                                          $( '#'+ region_id.toLowerCase() +'_label' ).append( "<center><p class='product' >" + WHAmarkers.getLayers().length + "&nbspProducts</p></center>" );
                                          WHAcount++;
                                          break;
                                       default:
                                      }
                    
                }
              });

            }

            var AFIcon = L.divIcon({  
              className: "my-div-icon",
              html: "<div class='af-region-font region_label' id='af_label' >AFRICA</div>"
            });

            var EAPIcon = L.divIcon({ 
              className: "my-div-icon", 
              html: "<div class='eap-region-font region_label' id='eap_label' ><center>EAST&nbsp;ASIA and&nbsp;the PACIFIC</center></div>"
            });

            var EURIcon = L.divIcon({ 
              className: "my-div-icon", 
              html: "<div class='eur-region-font region_label' id='eur_label' ><center>EUROPE</center></div>"
            });

            var NEAIcon = L.divIcon({  
              className: "my-div-icon",
              html: "<div class='nea-region-font region_label' id='nea_label' >NEAR&nbsp;EAST</div>"
            });

            var SCAIcon = L.divIcon({  
              className: "my-div-icon",
              html: "<div class='sca-region-font region_label' id='sca_label' ><center>SOUTH&nbsp;and CENTRAL&nbsp;ASIA</center></div>"
            });

            var WHAIcon = L.divIcon({  
              className: "my-div-icon",
              html: "<div class='wha-region-font region_label' id='wha_label' ><center>WESTERN HEMISPHERE</center></div>"
            });


            // you can set .my-div-icon styles in CSS
/*
            L.marker([5.482575, 26.501904], {icon: AFIcon}).addTo(map);
            L.marker([30.181217, 113.074164], {icon: EAPIcon}).addTo(map);
            L.marker([52.454666, 32.214791], {icon: EURIcon}).addTo(map);
            L.marker([27.408829, 34.412056], {icon: NEAIcon}).addTo(map);
            L.marker([42.906546, 67.195260], {icon: SCAIcon}).addTo(map);
            L.marker([-0.749253, -64.904349], {icon: WHAIcon}).addTo(map);
*/

            function clickTab(region) {
              console.log('hi');
              console.log(region);

              var regionCoord;
              var regionZoom;

              switch (region) {
                 case "AF":
                    regionCoord = [-1, -3];
                    regionZoom = 4;
                    activeLayer = "AF";
                    console.log('active layerAF: ');
                    console.log(activeLayer);
                    break;
                 case "EAP":
                    regionCoord = [5, 70];
                    regionZoom = 3;
                    activeLayer = "EAP";
                    break;
                 case "EUR":
                    regionCoord = [51, 22];
                    regionZoom = 4;
                    activeLayer = "EUR";
                    break;
                 case "NEA":
                    regionCoord = [28, 10];
                    regionZoom = 4;
                    activeLayer = "NEA";
                    break;
                 case "SCA":
                    regionCoord = [35, 52.5];
                    regionZoom = 4;
                    activeLayer = "SCA";
                    break;
                 case "WHA":
                    regionCoord = [-4, -72];
                    regionZoom = 4;
                    activeLayer = "WHA";
                    break;
                 default:
                    regionCoord = [14, -20];
                    regionZoom = 3;
                }

                if (typeof(products) != "undefined") {
                  //console.log("products are defined");
                  //products.clearLayers();
                }

                //map.setView(regionCoord,regionZoom);

                getProducts(region,regionCoord,regionZoom);

                $('.sidebar').addClass("sidebar-tall");

                if ( region == 'home' ) {
                  $('.sidebar').removeClass("sidebar-tall");
                }

                layerClicked = true;
            }

            $('a[role="tab"]').click(function () {
              console.log('hi2');
              console.log($(this).attr('id'));
              var region = $(this).attr('id');
              clickTab(region);
            })

            function clickLayer(e) {
                // Assuming the clicked feature is a shape, not a point marker.

                console.log('layer clicked');
                console.log(e);

                var regionCoord;
                var regionZoom;

                //console.log('bur prop');
                //console.log(this.feature.properties.RegBureau);

                switch (this.feature.properties.RegBureau) {
                 case "AF":
                    regionCoord = [-1, -3];
                    regionZoom = 4;
                    activeLayer = "AF";
                    sidebar.open('AF');
                    console.log('active layerAF: ');
                    console.log(activeLayer);
                    break;
                 case "EAP":
                    regionCoord = [5, 70];
                    regionZoom = 3;
                    activeLayer = "EAP";
                    sidebar.open('EAP');
                    break;
                 case "EUR":
                    regionCoord = [51, 22];
                    regionZoom = 4;
                    activeLayer = "EUR";
                    sidebar.open('EUR');
                    break;
                 case "NEA":
                    regionCoord = [28, 10];
                    regionZoom = 4;
                    activeLayer = "NEA";
                    sidebar.open('NEA');
                    break;
                 case "SCA":
                    regionCoord = [35, 52.5];
                    regionZoom = 4;
                    activeLayer = "SCA";
                    sidebar.open('SCA');
                    break;
                 case "WHA":
                    regionCoord = [-4, -72];
                    regionZoom = 4;
                    activeLayer = "WHA";
                    sidebar.open('WHA');
                    break;
                 default:
                    regionCoord = [14, -20];
                    regionZoom = 3;
                }


                if (typeof(products) != "undefined") {
                  //console.log("products are defined");
                  //products.clearLayers();
                }
                

                //map.fitBounds(this.getBounds());
                //map.setView(regionCoord,regionZoom);

                //window.map.setView([5, 70], 3);

                console.log(regionCoord);
                console.log(regionZoom);


                getProducts(this.feature.properties.RegBureau,regionCoord,regionZoom);


                //$('.sidebar').css({ "height": "89%"});
                $('.sidebar').addClass("sidebar-tall");

                layerClicked = true;

                //map.setView(event.latlng, 5);


            }


/*
            topoLayer.on("click", function (event) {
                // Assuming the clicked feature is a shape, not a point marker.
                map.fitBounds(event.layer.getBounds());
                //console.log(event.layer);
                //getProducts(event.layer.feature.properties.RegBureau);
                //map.setView(event.latlng, 5);
            });
*/

            //events
            var eventIcon = L.icon({
                iconUrl: "{{ site.baseurl }}/assets/img/mapgive_red_pt.png",
                iconSize: [30, 45],
                iconAnchor: [15, 40],
                popupAnchor: [0, 0]
            });

            $.ajax({
                dataType: "json",
                url: "{{ site.baseurl}}/events/events.json",
                success: function(response) {
                    var events = L.geoJson(response, {
                        zIndex: 100,
                        onEachFeature: function(feature, layer) {
                            var popupOptions = {maxWidth: 200};
                            layer.setIcon(eventIcon);
                            var popupContent = '<h4><a href="'+feature.properties.url+'">'+feature.properties.title+'</a></h4>';
                            layer.bindPopup(popupContent, popupOptions);
                        }
                    });
                    //events.addTo(map);
                    //geojsonLayers.push(events);
                    //geojsonLayers = sortLayers(geojsonLayers)
                    //updateRenderOrder(geojsonLayers);
                    //layerswitcher.append(createLink(map, events, 'Events', events.options.zIndex));

                    //map.addControl( new L.Control.ListMarkers({layer: events}) );
                    //markersLayer is a L.LayerGroup contains listing markers
                }
            });



   }());
</script>


